<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>STERLA</title>
<style>
/* ====== GLOBAL THEME ====== */
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
html,body{height:100%;}
body{
  background:linear-gradient(135deg,#d9e6ff,#ffffff);
  font-size:16px;
  overflow:hidden; /* body won't scroll; main will */
}

/* ====== LOGIN PAGE ====== */
#loginPage{width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;padding:30px;}
.login-container{width:80%;height:80%;background:rgba(255,255,255,0.4);backdrop-filter:blur(15px);border-radius:25px;display:flex;box-shadow:0 8px 20px rgba(0,0,0,0.15);}
.login-left{flex:1;background:#e8f0ff;border-radius:25px 0 0 25px;padding:40px;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;overflow:hidden;}
.doodle{position:absolute;opacity:0.15;width:140px;}
#pencil{top:20px;left:30px;transform:rotate(-15deg);}
#book{bottom:30px;right:40px;transform:rotate(10deg);}
#star{top:40%;left:45%;}
.logo-title{font-size:48px;font-weight:800;color:#2b4b9b;text-shadow:0 2px 6px rgba(0,0,0,0.15);}
.logo-sub{font-size:20px;color:#5370c9;margin-top:10px;text-align:center;}
.login-right{flex:1;padding:50px;display:flex;flex-direction:column;justify-content:center;}
.login-right h2{font-size:32px;font-weight:700;color:#2b4b9b;margin-bottom:20px;}
.inputBox{margin:15px 0;}
.inputBox input,.inputBox select{width:100%;padding:15px;border-radius:12px;border:1px solid #9bb2ff;background:rgba(255,255,255,0.6);}
#loginBtn{margin-top:20px;width:100%;padding:16px;border:none;border-radius:12px;font-size:18px;background:#2b4b9b;color:white;cursor:pointer;transition:0.3s;}
#loginBtn:hover{background:#1d3270;}

/* ====== APP LAYOUT ====== */
#appPage{
  display:none; /* shown after login */
  width:100%;
  height:100vh;
  display:flex;
  overflow:hidden;
  background:linear-gradient(135deg,#d9e6ff,#ffffff);
}
.glass{background:rgba(255,255,255,0.35);backdrop-filter:blur(12px);border-radius:18px;border:1px solid rgba(255,255,255,0.4);box-shadow:0 4px 20px rgba(0,0,0,0.1);}
#sidebar{width:260px;height:100vh;background:#1346b5c4;color:white;padding:25px;position:fixed;left:0;top:0;overflow:auto;}
#sidebar h2{font-size:26px;margin-bottom:25px;}
.nav-btn{width:100%;padding:12px;margin:8px 0;background:rgba(255,255,255,0.2);border:none;border-radius:12px;text-align:left;color:white;cursor:pointer;font-size:16px;transition:0.3s;}
.nav-btn:hover{background:rgba(255,255,255,0.35);}
#main{margin-left:280px;padding:30px;width:calc(100% - 280px);height:100vh;overflow-y:auto;}
.page{display:none;}
.active{display:block;}
#welcomeBox{width:100%;max-width:1100px;padding:30px;margin-top:25px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;}
#welcomeBox img{width:160px;filter: invert(25%);margin-top:10px;}
.subject-card{padding:18px;margin:12px;background:white;border-radius:15px;display:inline-block;cursor:pointer;width:150px;text-align:center;border:2px solid #1346b5;transition:0.3s;vertical-align:top;}
.subject-card:hover{background:#1346b5;color:white;}
.topic-btn{padding:12px;border-radius:12px;background:#1346b5;color:white;border:none;margin:5px;cursor:pointer;}
.output-box{margin-top:20px;padding:25px;border-radius:15px;background:white;min-height:200px;}
.announce{background:white;padding:12px;border-radius:12px;margin:10px 0;}
.teacher-only{display:none;}

/* ====== FLOWCHART BOX ====== */
.mindmap{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;padding:20px;min-height:300px;position:relative;}
.flow-box {
    position:absolute;
    width:180px;
    padding:15px;
    background:#ffffff;
    border:2px solid #1445b5;
    border-radius:10px;
    text-align:center;
    font-weight:600;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

/* ====== FLOWCHART ARROWS ====== */

.flow-line {
    stroke:#1445b5;
    stroke-width:3;
}

.flow-arrow {
    fill:#1445b5;
}

/* ====== CHATBOX ====== */
#chatBox{border:1px solid #ccc;padding:15px;height:400px;overflow-y:auto;border-radius:12px;margin-bottom:10px;background:white;}
#chatBox div{margin-bottom:8px;}
#chatInput{width:80%;padding:10px;border-radius:8px;border:1px solid #ccc;}
#chatBtn{padding:10px;border-radius:8px;background:#1346b5;color:white;border:none;cursor:pointer;}
#chatBtn:hover{background:#1d3270;}

/* small responsiveness */
@media (max-width:800px){
  #sidebar{display:none;}
  #main{margin-left:0;width:100%;}
  #welcomeBox{padding:18px;}
}
</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="loginPage">
  <div class="login-container">
    <div class="login-left">
      <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" class="doodle" id="pencil">
      <img src="https://cdn-icons-png.flaticon.com/512/2232/2232688.png" class="doodle" id="book">
      <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png" class="doodle" id="star">
      <div class="logo-title">STERLA</div>
      <div class="logo-sub">Your All-in-One Smart School Companion</div>
    </div>

    <div class="login-right">
      <h2>Login</h2>
      <div class="inputBox"><input type="text" id="username" placeholder="Enter your name" /></div>
      <div class="inputBox">
        <button id="studentLogin">Login as Student</button>
        <button id="teacherLogin">Login as Teacher</button>
      </div>
    </div>
  </div>
</div>

<!-- APP PAGE -->
<div id="appPage">
  <div id="sidebar">
    <h2>STERLA</h2>
    <button class="nav-btn" onclick="showPage('homePage')">üè† Home</button>
    <button class="nav-btn" onclick="showPage('dashboard')">üì¢ Dashboard</button>
    <button class="nav-btn" onclick="showPage('subjectsPage')">üìò Subjects</button>
    <button class="nav-btn" onclick="showPage('mmPage')">üß† Mind Map</button>
    <button class="nav-btn" onclick="showPage('quizPage')">üìù Quiz</button>
    <button class="nav-btn" onclick="showPage('wsPage')">üìÑ Worksheet</button>
    <button class="nav-btn teacher-only" onclick="showPage('managePage')">‚öôÔ∏è Teacher Panel</button>
    <button class="nav-btn" onclick="showPage('aiChatPage')">ü§ñ AI Chat</button>
  </div>

  <div id="main">
    <!-- HOME -->
    <div id="homePage" class="page active">
      <h1 id="welcomeUser"></h1>
      <div id="welcomeBox" class="glass">
        <div>
          <h2>Your learning companion</h2>
          <p>Choose a subject ‚Üí pick a topic ‚Üí get mindmap / quiz / worksheet!</p>
        </div>
        <img src="https://cdn-icons-png.flaticon.com/512/2942/2942943.png" alt="school icon">
      </div>
      <div style="margin-top:18px;">
        <h3>Quick Subjects</h3>
        <div id="subjectsQuick"></div>
      </div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" class="page">
      <h1>Dashboard</h1>
      <h2>Announcements</h2>
      <div class="announce">‚Ä¢ Chemistry worksheet due Monday</div>
      <div class="announce">‚Ä¢ Biology test next Friday</div>
      <div class="announce">‚Ä¢ Math homework submission closes tonight</div>
    </div>

    <!-- SUBJECTS -->
    <div id="subjectsPage" class="page">
      <h1>Select a Subject</h1>
      <div id="subjectsContainer"></div>
    </div>

    <!-- TOPICS -->
    <div id="topicPage" class="page">
      <h1 id="topicTitle"></h1>
      <div id="topicButtons"></div>
    </div>

    <!-- MINDMAP -->
  <div id="mindmap" class="page">
    <h2>Flowchart Generator</h2>

    <select id="mmTopic">
        <option value="">Choose topic</option>
        <option value="Photosynthesis">Photosynthesis</option>
        <option value="Water Cycle">Water Cycle</option>
        <option value="Cell Division">Cell Division</option>
    </select>

    <button onclick="loadFlowchart()">Generate Flowchart</button>

    <div id="flowArea" style="
        width:100%; 
        height:600px; 
        border:1px solid #ccc; 
        border-radius:10px; 
        background:white; 
        margin-top:20px;
        position:relative;
        overflow:auto;
    ">
        <svg id="flowSVG" width="2000" height="2000" style="position:absolute; top:0; left:0;"></svg>
    </div>
</div>
    <!-- QUIZ -->
    <div id="quizPage" class="page">
      <h1>Quiz</h1>
      <div class="output-box" id="quizOutput"></div>
    </div>

    <!-- WORKSHEET -->
    <div id="wsPage" class="page">
      <h1>Worksheet</h1>
      <div class="output-box" id="wsOutput"></div>
    </div>

    <!-- TEACHER PANEL -->
    <div id="managePage" class="page teacher-only">
      <h1>Teacher Panel</h1>
      <p>Here you can upload worksheets, add quizzes, view submissions, manage announcements.</p>
    </div>

    <!-- AI CHAT -->
    <div id="aiChatPage" class="page">
      <h1>AI Chat Assistant</h1>
      <div id="chatBox"></div>
      <input type="text" id="chatInput" placeholder="Ask me anything...">
      <button id="chatBtn" onclick="sendMessage()">Send</button>
    </div>

  </div>
</div>

<script>
/* ===== SELECT ELEMENTS ===== */
// ====== FIX: Get all elements before using them ======
const loginPage = document.getElementById("loginPage");
const appPage = document.getElementById("appPage");
const studentLogin = document.getElementById("studentLogin");
const teacherLogin = document.getElementById("teacherLogin");
const welcomeUser = document.getElementById("welcomeUser");

/* ===== LOGIN ===== */
studentLogin.onclick = () => doLogin("student");
teacherLogin.onclick = () => doLogin("teacher");

function doLogin(role){
  const name = document.getElementById("username").value;
  if(!name){ 
    alert("Enter name");
    return;
  }

  loginPage.style.display = "none";
  appPage.style.display = "flex";
  welcomeUser.innerText = "Welcome, " + name + " üëã";

  if(role === "teacher"){
    document.querySelectorAll(".teacher-only").forEach(el => el.style.display = "block");
  }
}

/* ===== DATA ===== */
const subjectTopics = {
  "English":["Grammar","Formal Letter","Speech","Prose"],
  "Math":["Algebra","Linear Equations","Mensuration"],
  "Science":["Reproduction in Animals","Sound","Electricity"],
  "Social Science":["1857 Revolt","Resources","Judiciary"],
  "Hindi":["Vyakaran","Patra Lekhan"],
  "Computer":["HTML","AI Basics"],
  "Sanskrit":["Shabd Roop","Dhatu Roop"],
  "French":["French Grammar","Culture"],
  "ICT":["Networks","Cybersecurity"]
};

let chosenTopic="";

/* ===== UI NAV ===== */
function showPage(p){
  document.querySelectorAll(".page").forEach(pg=>pg.classList.remove("active"));
  const el = document.getElementById(p);
  if(el) el.classList.add("active");
  if(p==="mmPage") loadMindmap();
  if(p==="quizPage") loadQuiz();
  if(p==="wsPage") loadWorksheet();
}

/* ===== SUBJECTS ===== */
function loadSubjects(){
  const box=document.getElementById("subjectsContainer");
  box.innerHTML="";
  subjectsQuick.innerHTML="";
  for(const sub in subjectTopics){
    box.innerHTML+=`<div class="subject-card" onclick="selectSubject('${sub}')">${sub}</div>`;
    subjectsQuick.innerHTML+=`<button class="topic-btn" onclick="selectSubject('${sub}')">${sub}</button>`;
  }
}
loadSubjects();

function selectSubject(sub){
  showPage("topicPage");
  topicTitle.innerText=sub+" Topics";
  const topics=subjectTopics[sub];
  let btns="";
  topics.forEach(tp=>btns+=`<button class="topic-btn" onclick="setTopic('${tp}')">${tp}</button>`);
  topicButtons.innerHTML=btns;
}
function setTopic(tp){
  chosenTopic=tp;
  // small UX: show a non-blocking toast-like temporary message instead of alert
  const prev = document.getElementById("topicToast");
  if(prev) prev.remove();
  const t = document.createElement("div");
  t.id="topicToast";
  t.style.position="fixed";
  t.style.right="20px";
  t.style.top="20px";
  t.style.background="#1346b5";
  t.style.color="white";
  t.style.padding="10px 14px";
  t.style.borderRadius="8px";
  t.style.boxShadow="0 6px 18px rgba(0,0,0,0.15)";
  t.innerText = "Topic selected: " + tp;
  document.body.appendChild(t);
  setTimeout(()=>{ if(t) t.remove(); }, 1500);
}

/* ===== MINDMAP ===== */

const flowData = {
    "Photosynthesis": [
        "Sunlight absorbed",
        "Water enters leaf",
        "CO‚ÇÇ taken in",
        "Glucose produced",
        "Oxygen released"
    ],
    "Water Cycle": [
        "Evaporation",
        "Condensation",
        "Cloud Formation",
        "Precipitation",
        "Collection"
    ],
    "Cell Division": [
        "Interphase",
        "Prophase",
        "Metaphase",
        "Anaphase",
        "Telophase + Cytokinesis"
    ]
};

function loadFlowchart() {
    const topic = document.getElementById("mmTopic").value;
    const area = document.getElementById("flowArea");
    const svg = document.getElementById("flowSVG");

    area.innerHTML = `<svg id="flowSVG" width="2000" height="2000" style="position:absolute; top:0; left:0;"></svg>`;
    
    if (!topic) {
        area.innerHTML = "Select a topic first!";
        return;
    =	q	1
}

/* ===== QUIZ BANK (Multiple Choice) ===== */
const quizBank = {
  "Grammar":[
    { q:"Which of the following is a noun?", options:["run","dog","quickly","beautiful"], answer:"dog" },
    { q:"Identify the verb in the sentence.", options:["is","happy","table","red"], answer:"is" },
    { q:"What is an adjective?", options:["A describing word","A doing word","A place","A person"], answer:"A describing word" }
  ],
  "Formal Letter":[
    {q:"Which salutation is correct?", options:["Dear Sir","Hi buddy","Hey","Yo"], answer:"Dear Sir"},
    {q:"Where does the date appear?", options:["Top right","Bottom left","Middle","Nowhere"], answer:"Top right"}
  ],
  "Speech":[
    {q:"Opening of speech should be?", options:["Attention grabber","Random word","Slang","Silent start"], answer:"Attention grabber"},
    {q:"How to conclude speech?", options:["Summarize & end memorably","Stop abruptly","Say random joke","Ignore"], answer:"Summarize & end memorably"}
  ],
  "Prose":[
    {q:"Prose is written in?", options:["Ordinary grammatical structure","Verse form","Poetry","Haiku"], answer:"Ordinary grammatical structure"},
    {q:"Does prose contain verses?", options:["No","Yes","Sometimes","Only poems"], answer:"No"}
  ],
  "Algebra":[
    {q:"Solve x + 5 = 12", options:["x=7","x=17","x=5","x=12"], answer:"x=7"},
    {q:"Simplify 2x + 3x", options:["5x","6x","x","2x"], answer:"5x"}
  ],
  "Linear Equations":[
    {q:"Solve 2x + 3 = 7", options:["x=2","x=5","x=3","x=1"], answer:"x=2"},
    {q:"Equation y = 2x + 1 forms?", options:["Straight line","Curve","Circle","Random"], answer:"Straight line"}
  ],
  "Mensuration":[
    {q:"Find area of rectangle 5x7 cm?", options:["35","12","57","None"], answer:"35"},
    {q:"Volume of cube side 4cm?", options:["64","16","12","8"], answer:"64"}
  ],
  "Reproduction in Animals":[
    {q:"Two types of reproduction?", options:["Sexual & Asexual","Only sexual","Only asexual","None"], answer:"Sexual & Asexual"},
    {q:"Fertilization occurs in?", options:["Animals & plants","Only animals","Only plants","None"], answer:"Animals & plants"}
  ],
  "Sound":[
    {q:"Sound is?", options:["Vibration","Color","Light","Force"], answer:"Vibration"},
    {q:"Speed of sound depends on?", options:["Medium","Color","Shape","Time"], answer:"Medium"}
  ],
  "Electricity":[
    {q:"Ohm's law formula?", options:["V=IR","V+IR","VI=R","None"], answer:"V=IR"},
    {q:"Series circuit has?", options:["Same current","Same voltage","Both","None"], answer:"Same current"}
  ],
  "1857 Revolt":[
    {q:"First War of Independence year?", options:["1857","1757","1947","1800"], answer:"1857"},
    {q:"Leader of revolt?", options:["Mangal Pandey","Nehru","Gandhi","Tipu Sultan"], answer:"Mangal Pandey"}
  ],
  "Resources":[
    {q:"Renewable resource example?", options:["Solar energy","Coal","Oil","Gas"], answer:"Solar energy"},
    {q:"Non-renewable resource?", options:["Coal","Sunlight","Wind","Water"], answer:"Coal"}
  ],
  "Judiciary":[
    {q:"Highest court in India?", options:["Supreme Court","High Court","District Court","None"], answer:"Supreme Court"},
    {q:"Independent judiciary protects?", options:["Rights","Money","Food","Vehicles"], answer:"Rights"}
  ],
  "Vyakaran":[
    {q:"Sandhi is?", options:["Joining of words","Verb","Noun","Adjective"], answer:"Joining of words"},
    {q:"Correct gender usage?", options:["Masculine/Feminine","Singular only","Plural only","None"], answer:"Masculine/Feminine"}
  ],
  "Patra Lekhan":[
    {q:"Formal letter closing?", options:["Yours sincerely","Bye","Cheers","Later"], answer:"Yours sincerely"},
    {q:"Should slang be used?", options:["No","Yes","Sometimes","Optional"], answer:"No"}
  ],
  "HTML":[
    {q:"HTML stands for?", options:["HyperText Markup Language","HighText Modern Language","Hyper Tool Markup Language","None"], answer:"HyperText Markup Language"},
    {q:"Tag for paragraph?", options:["<p>","<h1>","<img>","<a>"], answer:"<p>"}
  ],
  "AI Basics":[
    {q:"AI stands for?", options:["Artificial Intelligence","Automated Input","Artificial Interface","None"], answer:"Artificial Intelligence"},
    {q:"Narrow AI example?", options:["Chatbot","Self-driving car","Human brain","All"], answer:"Chatbot"}
  ],
  "Shabd Roop":[
    {q:"Shabd Roop studies?", options:["Word forms","Colors","Animals","Numbers"], answer:"Word forms"},
    {q:"Helps in?", options:["Sentence formation","Cooking","Music","Painting"], answer:"Sentence formation"}
  ],
  "Dhatu Roop":[
    {q:"Dhatu Roop is about?", options:["Verb roots","Nouns","Adjectives","Adverbs"], answer:"Verb roots"},
    {q:"Used for?", options:["Sentence construction","Painting","Drawing","Music"], answer:"Sentence construction"}
  ],
  "French Grammar":[
    {q:"French grammar includes?", options:["Articles, nouns, verbs","Colors","Music","Dance"], answer:"Articles, nouns, verbs"},
    {q:"Tense example?", options:["Present","Past","Future","All"], answer:"All"}
  ],
  "Culture":[
    {q:"French culture includes?", options:["Traditions, food, art","Cars","Technology","Animals"], answer:"Traditions, food, art"},
    {q:"Helps in?", options:["Communication","Sports","Mathematics","Physics"], answer:"Communication"}
  ],
  "Networks":[
    {q:"Network connects?", options:["Computers","People","Books","Animals"], answer:"Computers"},
    {q:"Purpose?", options:["Share data","Cook","Sleep","Run"], answer:"Share data"}
  ],
  "Cybersecurity":[
    {q:"Cybersecurity protects?", options:["Computers & networks","Plants","Animals","Buildings"], answer:"Computers & networks"},
    {q:"Threat example?", options:["Hacking","Cooking","Running","Painting"], answer:"Hacking"}
  ]
};

/* ====== WORKSHEET BANK ===== */
const wsBank = {
  "Grammar":["1. Write 5 nouns.","2. Write 5 verbs.","3. Identify parts of speech.","4. Form 5 adverbs.","5. Write 3 complex sentences."],
  "Formal Letter":["1. Write a formal letter to principal.","2. Draft letter to bank manager.","3. Compose letter to editor.","4. Draft complaint letter.","5. Write letter to teacher."],
  "Speech":["1. Write a 2-minute speech on pollution.","2. Speech on importance of education.","3. Speech on health and hygiene.","4. Speech on computer usage.","5. Speech on favorite hobby."],
  "Prose":["1. Read passage & answer questions.","2. Summarize paragraph.","3. Identify main idea.","4. Write continuation.","5. Identify characters."],
  "Algebra":["1. Solve 5x + 3 = 18","2. Factor x^2 + 7x + 12","3. Simplify 4x + 9x","4. Solve 3x - 8 = 10","5. Form expression for sum of 2 numbers."],
  "Linear Equations":["1. Solve 2x + 5 = 15","2. Solve 3x - y = 6","3. Draw line y = x + 2","4. Solve 4x + 3y = 12","5. Apply elimination method."],
  "Mensuration":["1. Area of rectangle 5x7 cm","2. Perimeter of square 6 cm","3. Volume of cube 4 cm","4. Surface area of cylinder r=3,h=7","5. Circumference of circle r=5cm"],
  "Reproduction in Animals":["1. Draw human reproductive system","2. Explain fertilization","3. Define binary fission","4. Define budding","5. List types of reproduction"],
  "Sound":["1. Draw wave diagram","2. Define frequency","3. Define amplitude","4. Explain echo","5. Speed of sound in water"],
  "Electricity":["1. Draw simple circuit","2. Ohm‚Äôs law calculation","3. Identify series circuit","4. Identify parallel circuit","5. Name safety devices"],
  "1857 Revolt":["1. List causes","2. Name key leaders","3. Write main events","4. Outcome of revolt","5. Lessons learned"],
  "Resources":["1. List renewable resources","2. List non-renewable resources","3. Explain conservation","4. Importance of water conservation","5. Forest conservation examples"],
  "Judiciary":["1. Write role of Supreme Court","2. High Court duties","3. Lower court examples","4. Judge responsibilities","5. Importance of independent judiciary"],
  "Vyakaran":["1. Examples of Sandhi","2. Examples of Samas","3. Correct gender usage","4. Singular/dual/plural examples","5. Correct tense sentences"],
  "Patra Lekhan":["1. Write formal letter to principal","2. Write informal letter to friend","3. Include sender & receiver","4. Use proper salutation","5. End with signature"],
  "HTML":["1. Create simple HTML page","2. Add headings & paragraphs","3. Insert image","4. Add hyperlink","5. Create list items"],
  "AI Basics":["1. List types of AI","2. Example of narrow AI","3. Example of general AI","4. AI application in healthcare","5. AI in education"],
  "Shabd Roop":["1. Write singular/plural forms","2. Change gender of words","3. Correct case","4. Form words for verbs","5. Use in sentences"],
  "Dhatu Roop":["1. Write root verb forms","2. Present tense","3. Past tense","4. Future tense","5. Make sentences using verb"],
  "French Grammar":["1. Write 5 nouns","2. Write 5 adjectives","3. Conjugate 3 verbs","4. Form simple sentences","5. Translate sentences"],
  "Culture":["1. List French festivals","2. Describe French food","3. Famous French musicians","4. Social etiquette","5. Daily life in France"],
  "Networks":["1. Draw simple network diagram","2. Explain types of networks","3. Define LAN & WAN","4. Identify network devices","5. Network examples"],
  "Cybersecurity":["1. List common cyber threats","2. Define firewall","3. Explain antivirus software","4. Safety tips online","5. Case study of hacking"]
};

/* ====== AI CHAT WITH DEFAULT Q&A ===== */
const aiBank = {
  "Grammar":[{q:"noun",a:"A noun is a person, place, thing, or idea."},{q:"verb",a:"A verb is an action or state of being."}],
  "Formal Letter":[{q:"formal",a:"A formal letter is written in a professional tone for official purposes."}],
  "Speech":[{q:"speech",a:"A speech is a talk delivered to an audience with a clear structure."}],
  "Prose":[{q:"prose",a:"Prose is ordinary written language without metrical structure."}],
  "Algebra":[{q:"solve",a:"To solve x+5=12 subtract 5 from both sides so x=7."}],
  "Linear Equations":[{q:"linear",a:"A linear equation has variables to the power 1 and graphs as a straight line."}],
  "Mensuration":[{q:"area",a:"Mensuration includes area, perimeter and volume formulas for shapes."}],
  "Reproduction in Animals":[{q:"reproduction",a:"Reproduction produces new organisms; types include sexual and asexual."}],
  "Sound":[{q:"sound",a:"Sound is a vibration that travels through a medium."}],
  "Electricity":[{q:"electricity",a:"Electricity is the flow of electric charge; V = IR (Ohm's law)."}],
  "1857 Revolt":[{q:"1857",a:"The 1857 Revolt was a large-scale uprising against British rule in India."}],
  "Resources":[{q:"resources",a:"Resources are materials (renewable or non-renewable) used by humans."}],
  "Judiciary":[{q:"judiciary",a:"The judiciary interprets and applies the law through courts."}],
  "Vyakaran":[{q:"vyakaran",a:"Vyakaran means grammar in Hindi; it covers rules of language."}],
  "Patra Lekhan":[{q:"patra",a:"Patra Lekhan is letter-writing in Hindi, formal or informal formats."}],
  "HTML":[{q:"html",a:"HTML structures web content using tags like <p>, <h1>, <a>."}],
  "AI Basics":[{q:"ai",a:"AI is the simulation of human intelligence in machines."}],
  "Shabd Roop":[{q:"shabd",a:"Shabd Roop studies different forms of words in Sanskrit."}],
  "Dhatu Roop":[{q:"dhatu",a:"Dhatu Roop deals with verb root forms and their conjugations."}],
  "French Grammar":[{q:"french",a:"French grammar covers articles, nouns, adjectives, and verb conjugations."}],
  "Culture":[{q:"culture",a:"French culture includes food, art, festivals, and social etiquette."}],
  "Networks":[{q:"networks",a:"Networks connect devices so they can share data and resources."}],
  "Cybersecurity":[{q:"cyber",a:"Cybersecurity protects systems and data from digital threats."}]
};

/* ====== QUIZ WITH CLICKABLE OPTIONS ===== */
function loadQuiz(){
  const out = document.getElementById("quizOutput");
  const qArr = quizBank[chosenTopic];
  if(!qArr){ out.innerHTML = "<p>Quiz not available. Select a topic first.</p>"; return; }

  out.innerHTML = ""; // clear previous quiz

  qArr.forEach((qObj, idx) => {
    const div = document.createElement("div");
    div.style.marginBottom = "15px";

    const qP = document.createElement("p");
    qP.innerText = (idx+1) + ". " + qObj.q;
    div.appendChild(qP);

    qObj.options.forEach(opt => {
      const btn = document.createElement("button");
      btn.className = "topic-btn";
      btn.style.marginRight = "8px";
      btn.style.marginTop = "6px";
      btn.innerText = opt;
      btn.onclick = () => checkAnswer(idx, opt);
      div.appendChild(btn);
    });

    out.appendChild(div);
  });
}

function checkAnswer(idx, selected){
  const correct = quizBank[chosenTopic][idx].answer;
  // small visual feedback using toast style instead of alert
  const toast = document.createElement("div");
  toast.style.position="fixed";
  toast.style.left="50%";
  toast.style.transform="translateX(-50%)";
  toast.style.bottom="30px";
  toast.style.padding="12px 18px";
  toast.style.borderRadius="8px";
  toast.style.color="white";
  toast.style.boxShadow="0 8px 24px rgba(0,0,0,0.2)";
  if(selected === correct){
    toast.style.background="#2ecc71";
    toast.innerText = `‚úÖ Correct! (${selected})`;
  } else {
    toast.style.background="#e74c3c";
    toast.innerText = `‚ùå Wrong! Correct: ${correct}`;
  }
  document.body.appendChild(toast);
  setTimeout(()=>toast.remove(),1400);
}

/* ====== WORKSHEET ===== */
function loadWorksheet(){
  const out=document.getElementById("wsOutput");
  const w=wsBank[chosenTopic];
  if(!w){ out.innerHTML="Worksheet not available. Select a topic first."; return; }
  out.innerHTML = `<ol>${w.map(item=>`<li style="margin-bottom:8px;">${item}</li>`).join("")}</ol>`;
}

/* ====== AI CHAT ===== */
function sendMessage(){
  const input = document.getElementById("chatInput");
  const msg = input.value.trim();
  if(!msg) return;
  const chatBox = document.getElementById("chatBox");
  chatBox.innerHTML += `<div><b>You:</b> ${escapeHtml(msg)}</div>`;
  input.value = "";

  let reply = "Sorry, I don't know the answer.";

  if(chosenTopic && aiBank[chosenTopic]){
    const topicQA = aiBank[chosenTopic];
    // match by keyword present in user's message
    const match = topicQA.find(obj => msg.toLowerCase().includes(obj.q.toLowerCase()));
    reply = match ? match.a : topicQA[Math.floor(Math.random() * topicQA.length)].a;
  } else if(!chosenTopic) {
    reply = "Select a topic first to get subject-specific answers.";
  }

  chatBox.innerHTML += `<div><b>AI:</b> ${escapeHtml(reply)}</div>`;
  chatBox.scrollTop = chatBox.scrollHeight;
}

/* simple escape to avoid HTML injection in chat */
function escapeHtml(text){
  return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

/* ====== MINDBANK (for mindmap bubbles) ===== */
const mmBank = {
  "Grammar":["Parts of Speech","Sentence Structure","Tenses","Punctuation","Usage Rules"],
  "Formal Letter":["Sender Address","Date","Receiver Address","Subject","Salutation","Body Paragraphs","Closing"],
  "Speech":["Introduction","Body Points","Conclusion","Eye Contact","Gestures","Voice Modulation"],
  "Prose":["Paragraphs","Characters","Storyline","Dialogue","Narrative Flow"],
  "Algebra":["Expressions","Equations","Formulas","Solve for Unknowns","Linear & Quadratic"],
  "Linear Equations":["Variables","Equation Form","Graph Representation","Substitution","Elimination"],
  "Mensuration":["Area","Perimeter","Volume","Surface Area","Formulas"],
  "Reproduction in Animals":["Sexual Reproduction","Asexual Reproduction","Human Systems","Fertilization","Development"],
  "Sound":["Vibration","Pitch","Amplitude","Frequency","Reflection"],
  "Electricity":["Electric Charge","Ohm's Law","Circuits","Series & Parallel","Safety Devices"],
  "1857 Revolt":["Causes","Key Leaders","Events","Outcome","Lessons Learned"],
  "Resources":["Renewable","Non-renewable","Conservation","Sustainability","Examples"],
  "Judiciary":["Supreme Court","High Court","Lower Courts","Judges","Rights Protection"],
  "Vyakaran":["Sandhi","Samas","Ling","Vachya","Tense & Vachan"],
  "Patra Lekhan":["Formal Letter","Informal Letter","Sender & Receiver","Salutation","Closing"],
  "HTML":["Tags","Attributes","Headings","Paragraphs","Links & Images"],
  "AI Basics":["Narrow AI","General AI","Applications","Data & Algorithms","Automation"],
  "Shabd Roop":["Singular/Plural","Gender Changes","Case Forms","Usage","Verb Forms"],
  "Dhatu Roop":["Root Verb Forms","Tenses","Sentence Construction","Examples","Practice"],
  "French Grammar":["Articles","Nouns","Adjectives","Verbs","Tenses"],
  "Culture":["Festivals","Food","Music","Lifestyle","Etiquette"],
  "Networks":["LAN","WAN","Topology","Devices","Protocols"],
  "Cybersecurity":["Threats","Firewall","Antivirus","Safe Practices","Case Studies"]
};

/* ====== initialize quick UI ===== */
(function init(){
  // if user already stored, show app
  const storedName = localStorage.getItem("sterlaUser");
  const storedRole = localStorage.getItem("sterlaRole");
  if(storedName){
    welcomeUser.innerText = "Welcome, " + storedName + " üëã";
    loginPage.style.display = "none";
    appPage.style.display = "flex";
    if(storedRole==="teacher") document.querySelectorAll(".teacher-only").forEach(el=>el.style.display="block");
  }
})();
</script>
</body>
</html>
